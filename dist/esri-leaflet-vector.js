/* esri-leaflet-vector - v2.0.0 - Thu Sep 13 2018 17:46:53 GMT-0700 (PDT)
 * Copyright (c) 2018 Environmental Systems Research Institute, Inc.
 * Apache-2.0 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("leaflet"),require("mapbox-gl"),require("esri-leaflet")):"function"==typeof define&&define.amd?define(["exports","leaflet","mapbox-gl","esri-leaflet"],e):e((t.L=t.L||{},t.L.esri=t.L.esri||{},t.L.esri.Vector={}),t.L,t.mapboxgl,t.L.esri)}(this,function(t,e,i,a){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;function o(t,i){a.request(t,{},function(o,s){if(o)throw new Error("Unable to fetch vector tile style metadata");a.request(s.sources.esri.url,{},function(a,o){a||(n(s,o,t),i._mapboxGL=e.mapboxGL({accessToken:"ezree",style:s}),i._ready=!0,i.fire("ready",{},!0))},i)},i)}function n(t,e,i){t.sources.esri.url&&-1===t.sources.esri.url.indexOf("http")&&(t.sources.esri.url=i.replace("/resources/styles/root.json","")),e.tiles&&"/"!==e.tiles[0].charAt(0)&&(e.tiles[0]="/"+e.tiles[0]),e.tileMap&&"/"!==e.tileMap.charAt(0)&&(e.tileMap="/"+e.tileMap),t.sources.esri={type:"vector",scheme:"xyz",tilejson:e.tilejson||"2.0.0",format:e.tileInfo&&e.tileInfo.format||"pbf",index:e.tileMap?t.sources.esri.url+e.tileMap:null,tiles:[t.sources.esri.url+e.tiles[0]],description:e.description,name:e.name},-1===t.glyphs.indexOf("http")&&(t.glyphs=i.replace("styles/root.json",t.glyphs.replace("../","")),t.sprite=i.replace("styles/root.json",t.sprite.replace("../","")))}L.MapboxGL=L.Layer.extend({options:{updateInterval:32},initialize:function(t){if(L.setOptions(this,t),!t.accessToken)throw new Error("You should provide a Mapbox GL access token as a token option.");mapboxgl.accessToken=t.accessToken;var e,i,a,o,n,s,r;this._throttledUpdate=(e=L.Util.bind(this._update,this),i=this.options.updateInterval,r=function(){o=!1,n&&(s.apply(a,n),n=!1)},s=function(){o?n=arguments:(e.apply(a,arguments),setTimeout(r,i),o=!0)})},onAdd:function(t){this._glContainer||this._initContainer(),t._panes.tilePane.appendChild(this._glContainer),this._initGL(),this._offset=this._map.containerPointToLayerPoint([0,0]),t.options.zoomAnimation&&L.DomEvent.on(t._proxy,L.DomUtil.TRANSITION_END,this._transitionEnd,this)},onRemove:function(t){this._map.options.zoomAnimation&&L.DomEvent.off(this._map._proxy,L.DomUtil.TRANSITION_END,this._transitionEnd,this),t.getPanes().tilePane.removeChild(this._glContainer),this._glMap.remove(),this._glMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd}},_initContainer:function(){var t=this._glContainer=L.DomUtil.create("div","leaflet-gl-layer"),e=this._map.getSize();t.style.width=e.x+"px",t.style.height=e.y+"px"},_initGL:function(){var t=this._map.getCenter(),e=L.extend({},this.options,{container:this._glContainer,interactive:!1,center:[t.lng,t.lat],zoom:this._map.getZoom()-1,attributionControl:!1});this._glMap=new mapboxgl.Map(e),this._glMap.transform.latRange=null,this._glMap._canvas.canvas?this._glMap._actualCanvas=this._glMap._canvas.canvas:this._glMap._actualCanvas=this._glMap._canvas,L.DomUtil.addClass(this._glMap._actualCanvas,"leaflet-image-layer"),L.DomUtil.addClass(this._glMap._actualCanvas,"leaflet-zoom-animated")},_update:function(t){if(this._offset=this._map.containerPointToLayerPoint([0,0]),!this._zooming){var e=this._map.getSize(),i=this._glContainer,a=this._glMap,o=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(i,o);var n=this._map.getCenter(),s=a.transform;s.center=mapboxgl.LngLat.convert([n.lng,n.lat]),s.zoom=this._map.getZoom()-1,a.transform.width!==e.x||a.transform.height!==e.y?(i.style.width=e.x+"px",i.style.height=e.y+"px",null!==a._resize&&void 0!==a._resize?a._resize():a.resize()):null!==a._update&&void 0!==a._update?a._update():a.update()}},_pinchZoom:function(t){this._glMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(),t.zoom,t.center);L.DomUtil.setTransform(this._glMap._actualCanvas,i.subtract(this._offset),e)},_zoomStart:function(t){this._zooming=!0},_zoomEnd:function(){var t=this._map.getZoomScale(this._map.getZoom()),e=this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(),this._map.getZoom(),this._map.getCenter());L.DomUtil.setTransform(this._glMap._actualCanvas,e.subtract(this._offset),t),this._zooming=!1},_transitionEnd:function(t){L.Util.requestAnimFrame(function(){var t=this._map.getZoom(),e=this._map.getCenter(),i=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());L.DomUtil.setTransform(this._glMap._actualCanvas,i,1),this._glMap.once("moveend",L.Util.bind(function(){this._zoomEnd()},this)),this._glMap.jumpTo({center:e,zoom:t-1})},this)}}),L.mapboxGL=function(t){return new L.MapboxGL(t)};var s=e.Layer.extend({statics:{URLPREFIX:"https://www.arcgis.com/sharing/rest/content/items/",URLSUFFIX:"/resources/styles/root.json",STYLES:{OpenStreetMap:"3e1a00aeae81496587988075fe529f71",Streets:"de26a3cf4cc9451298ea173c4b324736",StreetsRelief:"b266e6d17fc345b498345613930fbd76",Topographic:"7a6bf0e8cb5a418085e66c0485e74d19",StreetsNight:"93554006894c45a88136127535878fca",Newspaper:"dfb04de5f3144a80bc3f9f336228d24a",Navigation:"63c47b7177f946b49902c24129b87252",Nova:"75f4dfdff19e445395653121a95a85db",ColoredPencil:"4cf7e1fb9f254dcda9c8fbadb15cf0f8",Hybrid:"30d6b8271e1849cd9c3042060001f425",Gray:"291da5eab3a0412593b66d384379f89f",DarkGray:"5e9b3685f4c24d8781073dd928ebda50",HumanGeography:"2afe5b807fa74006be6363fd243ffb30",HumanGeographyDetail:"97fa1365da1e43eabb90d0364326bc2d",DarkHumanGeography:"d7397603e9274052808839b70812be50"}},initialize:function(t){if(t={key:t},this._basemap=t.key,"string"!=typeof t.key||!s.STYLES[t.key])throw new Error('L.esri.Vector.Basemap: Invalid parameter. Use one of "DarkGray", "Gray", "Hybrid", "Navigation", "Streets", "StreetsNight", "StreetsRelief", "Topographic"');o(s.URLPREFIX+s.STYLES[t.key]+s.URLSUFFIX,this)},onAdd:function(t){this._map=t,a.Util.setEsriAttribution(t),t.attributionControl&&("OpenStreetMap"===this._basemap?(t.attributionControl.setPrefix('<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'),t.attributionControl.addAttribution('<span class="esri-dynamic-attribution">&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, map layer by Esri</span>')):(a.Util._getAttributionData("https://static.arcgis.com/attribution/World_Street_Map",t),t.attributionControl.addAttribution('<span class="esri-dynamic-attribution">USGS, NOAA</span>'))),this._ready?this._asyncAdd():this.once("ready",function(){this._asyncAdd()},this)},onRemove:function(t){if(t.off("moveend",a.Util._updateMapAttribution),t.removeLayer(this._mapboxGL),t.attributionControl){var e=document.getElementsByClassName("esri-dynamic-attribution")[0].outerHTML;t.attributionControl.removeAttribution(e)}},_asyncAdd:function(){var t=this._map;t.getContainer().style.background=this._mapboxGL.options.style.layers[0].paint["background-color"]||"#e1e3d0",t.on("moveend",a.Util._updateMapAttribution),this._mapboxGL.addTo(t,this)}});var r=e.Layer.extend({statics:{URLPREFIX:"https://www.arcgis.com/sharing/rest/content/items/"},initialize:function(t){if("string"!=typeof(t={id:t}).id)throw new Error("L.esri.Vector.Layer: Invalid parameter. Use the id of an ArcGIS Online vector tile item");var i,s,l=r.URLPREFIX+t.id;a.request(l,{},function(t,r){t||(-1===(i=r.url).indexOf("basemaps.arcgis.com")?(this._customTileset=!0,r.accessInformation&&(this._copyrightText=r.accessInformation),a.request(i,{},function(t,o){t||("/"!==o.defaultStyles.charAt(0)&&(o.defaultStyles="/"+o.defaultStyles),s=i+o.defaultStyles+"/root.json",a.request(s,{},function(t,i){t||(n(i,o,s),this._mapboxGL=e.mapboxGL({accessToken:"ezree",style:i}),this._ready=!0,this.fire("ready",{},!0))},this))},this)):o(l+"/resources/styles/root.json",this))},this)},onAdd:function(t){this._map=t,a.Util.setEsriAttribution(t),this._ready?this._asyncAdd():this.once("ready",function(){this._asyncAdd()},this)},onRemove:function(t){if(t.off("moveend",a.Util._updateMapAttribution),t.removeLayer(this._mapboxGL),t.attributionControl){var e=document.getElementsByClassName("esri-dynamic-attribution")[0].outerHTML;t.attributionControl.removeAttribution(e)}},_asyncAdd:function(){var t=this._map;t.attributionControl&&(this._customTileset?this._copyrightText&&t.attributionControl.addAttribution('<span class="esri-dynamic-attribution">'+this._copyrightText+"</span>"):(a.Util._getAttributionData("https://static.arcgis.com/attribution/World_Street_Map",t),t.attributionControl.addAttribution('<span class="esri-dynamic-attribution">USGS, NOAA</span>'),t.on("moveend",a.Util._updateMapAttribution))),t.getContainer().style.background=this._mapboxGL.options.style.layers[0].paint["background-color"],this._mapboxGL.addTo(t,this)}});t.VERSION="2.0.0",t.Basemap=s,t.basemap=function(t){return new s(t)},t.Layer=r,t.layer=function(t){return new r(t)},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=esri-leaflet-vector.js.map
